<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#3a86ff">
  <meta name="description" content="Inscription EARNESIA - Rejoignez notre plateforme d'opportunités financières">
  
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>EARNESIA - Inscription</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #3a86ff;
      --primary-dark: #2667cc;
      --primary-light: #6ba3ff;
      --secondary: #00b4d8;
      --accent: #00cc88;
      --warning: #ffd166;
      --danger: #ff6b6b;
      --success: #00cc88;
      
      --light: #ffffff;
      --light-gray: #f8f9fa;
      --gray: #e9ecef;
      --dark-gray: #6c757d;
      --text: #1a1a2e;
      --text-light: #4a4a68;
      
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 20px 50px rgba(58, 134, 255, 0.2);
      --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      --radius: 20px;
      --radius-sm: 12px;
    }
    
    .dark-mode {
      --light: #0f172a;
      --light-gray: #1e293b;
      --gray: #334155;
      --dark-gray: #94a3b8;
      --text: #f1f5f9;
      --text-light: #cbd5e1;
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      --shadow-hover: 0 20px 50px rgba(58, 134, 255, 0.3);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      height: 100%;
      overflow-x: hidden;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #6B8DD6 100%);
      background-attachment: fixed;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      transition: background 0.5s ease;
    }
    
    body.dark-mode {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }
    
    @keyframes confettiBurst {
      0% { opacity: 1; transform: translate(0, 0) rotate(0deg) scale(1); }
      100% { opacity: 0; transform: translate(var(--tx), var(--ty)) rotate(720deg) scale(0); }
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .container {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      animation: fadeIn 0.6s ease-out;
      position: relative;
    }
    
    .lang-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }
    
    .lang-btn {
      padding: 10px 16px;
      border-radius: 25px;
      background: var(--light);
      border: 2px solid var(--gray);
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
      color: var(--text);
      font-weight: 600;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .lang-btn:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }
    
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    
    .theme-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--light);
      border: 2px solid var(--gray);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
      color: var(--text);
      font-size: 1.2rem;
    }
    
    .theme-btn:hover {
      transform: scale(1.1) rotate(15deg);
      border-color: var(--primary);
    }
    
    .logo-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .logo-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 15px;
      gap: 12px;
    }
    
    .logo-img {
      height: 70px;
      width: 70px;
      object-fit: cover;
      border-radius: 18px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 8px;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    
    .logo-img:hover {
      transform: scale(1.1) rotate(5deg);
    }
    
    .logo-text {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #fff 0%, #e0e7ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'Poppins', sans-serif;
      letter-spacing: -1px;
      text-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    
    .tagline {
      font-size: 1rem;
      color: rgba(255,255,255,0.9);
      font-weight: 500;
    }
    
    .form-progress {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-bottom: 55px;
      position: relative;
      z-index: 10;
    }
    
    .progress-step {
      position: relative;
      z-index: 11;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--light);
      border: 3px solid var(--gray);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--dark-gray);
      font-weight: 700;
      font-size: 1rem;
      transition: var(--transition);
      font-family: 'Poppins', sans-serif;
    }
    
    .progress-step.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
      transform: scale(1.15);
      box-shadow: 0 0 20px rgba(58, 134, 255, 0.5);
    }
    
    .progress-step.completed {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    
    .progress-step.completed::after {
      content: '\2713';
      font-size: 1.1rem;
    }
    
    .progress-step.completed span {
      display: none;
    }
    
    .step-label {
      position: absolute;
      top: 48px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      color: rgba(255,255,255,0.8);
      white-space: nowrap;
      font-weight: 600;
      z-index: 12;
    }
    
    .card {
      background: var(--light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 35px 30px;
      position: relative;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
      background-size: 200% 100%;
      animation: shimmer 3s infinite linear;
      border-radius: var(--radius) var(--radius) 0 0;
    }
    
    .form-sections-container {
      position: relative;
      min-height: 380px;
      overflow: hidden;
    }
    
    .form-section {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease, transform 0.5s ease;
      transform: translateY(20px);
    }
    
    .form-section.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
      position: relative;
    }
    
    .section-header {
      text-align: center;
      margin-bottom: 28px;
    }
    
    .section-header h1 {
      color: var(--text);
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 8px;
      font-family: 'Poppins', sans-serif;
    }
    
    .section-header p {
      color: var(--text-light);
      font-size: 0.95rem;
    }
    
    .form-group {
      margin-bottom: 22px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
      font-size: 0.9rem;
    }
    
    .input-group {
      display: flex;
      align-items: center;
      background: var(--light-gray);
      border-radius: var(--radius-sm);
      border: 2px solid var(--gray);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .input-group:focus-within {
      border-color: var(--primary);
      background: var(--light);
      box-shadow: 0 0 0 4px rgba(58, 134, 255, 0.15);
    }
    
    .input-group.error {
      border-color: var(--danger);
      animation: shake 0.5s;
    }
    
    .input-icon {
      padding: 0 16px;
      color: var(--dark-gray);
      font-size: 1.1rem;
      min-width: 50px;
      text-align: center;
    }
    
    .input-group:focus-within .input-icon {
      color: var(--primary);
    }
    
    input, select {
      width: 100%;
      padding: 16px 12px;
      border: none;
      background: transparent;
      color: var(--text);
      font-size: 1rem;
      font-weight: 500;
      outline: none;
      font-family: inherit;
    }
    
    input::placeholder {
      color: var(--dark-gray);
      font-weight: 400;
    }
    
    input:-webkit-autofill {
      -webkit-box-shadow: 0 0 0px 1000px var(--light-gray) inset;
      -webkit-text-fill-color: var(--text);
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--dark-gray);
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: var(--transition);
    }
    
    .password-toggle:hover {
      background: rgba(0, 0, 0, 0.05);
      color: var(--primary);
    }
    
    .password-strength {
      margin-top: 12px;
    }
    
    .strength-meter {
      height: 6px;
      background: var(--gray);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 6px;
    }
    
    .strength-meter::before {
      content: '';
      display: block;
      height: 100%;
      width: var(--strength, 0%);
      background: var(--strength-color, var(--danger));
      transition: width 0.4s ease, background 0.4s ease;
    }
    
    .strength-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--dark-gray);
    }
    
    .input-hint {
      font-size: 0.8rem;
      margin-top: 6px;
      font-weight: 500;
    }
    
    .country-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--light);
      border: 2px solid var(--gray);
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow);
      max-height: 250px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
      margin-top: 5px;
    }
    
    .country-dropdown.show {
      display: block;
      animation: fadeSlideIn 0.3s ease;
    }
    
    .country-option {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.95rem;
    }
    
    .country-option:hover {
      background: var(--light-gray);
    }
    
    .country-option .flag {
      font-size: 1.3rem;
    }
    
    .summary {
      background: var(--light-gray);
      border-radius: var(--radius-sm);
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--gray);
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .summary-item {
      padding: 12px;
      background: var(--light);
      border-radius: 8px;
      border: 1px solid var(--gray);
    }
    
    .summary-label {
      font-size: 0.75rem;
      color: var(--dark-gray);
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
    }
    
    .summary-value {
      color: var(--text);
      font-weight: 600;
      font-size: 0.9rem;
      word-break: break-word;
    }
    
    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      cursor: pointer;
      accent-color: var(--primary);
      flex-shrink: 0;
    }
    
    .terms-text {
      color: var(--text-light);
      font-size: 0.85rem;
      line-height: 1.5;
    }
    
    .terms-text a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }
    
    .terms-text a:hover {
      text-decoration: underline;
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }
    
    .btn {
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 16px 24px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-family: 'Poppins', sans-serif;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
      transition: left 0.6s ease;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn:active {
      transform: translateY(-1px);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .btn-secondary {
      background: var(--light-gray);
      color: var(--text);
      border: 2px solid var(--gray);
    }
    
    .btn-secondary:hover {
      border-color: var(--primary);
      background: var(--light);
    }
    
    .login-link {
      text-align: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--gray);
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .login-link a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }
    
    .footer {
      margin-top: 25px;
      text-align: center;
      color: rgba(255,255,255,0.7);
      font-size: 0.8rem;
    }
    
    .footer-links {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .footer-links a {
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
    }
    
    .footer-links a:hover {
      color: white;
    }
    
    .notification-system {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 350px;
    }
    
    .notification {
      padding: 16px 20px;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      animation: fadeSlideIn 0.4s ease;
      background: var(--light);
      border-left: 4px solid var(--primary);
    }
    
    .notification.success { border-left-color: var(--success); }
    .notification.error { border-left-color: var(--danger); }
    .notification.warning { border-left-color: var(--warning); }
    
    .notification-info { flex: 1; }
    .notification-title { font-weight: 600; color: var(--text); margin-bottom: 4px; font-size: 0.9rem; }
    .notification-message { color: var(--text-light); font-size: 0.85rem; }
    
    .notification-close {
      background: none;
      border: none;
      color: var(--dark-gray);
      cursor: pointer;
      padding: 4px;
      border-radius: 50%;
    }
    
    .loading {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }
    
    .terms-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .terms-modal.show { display: flex; }
    
    .terms-content {
      background: var(--light);
      border-radius: var(--radius);
      padding: 30px;
      max-width: 550px;
      max-height: 80vh;
      overflow-y: auto;
      animation: fadeIn 0.3s ease;
    }
    
    .terms-content h2 { margin-bottom: 20px; color: var(--text); font-family: 'Poppins', sans-serif; }
    .terms-content h3, .terms-content h4 { margin: 15px 0 10px; color: var(--text); }
    .terms-content p { color: var(--text-light); margin-bottom: 10px; line-height: 1.6; }
    
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      overflow: hidden;
    }
    
    .confetti {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 2px;
      animation: confettiBurst 2s ease-out forwards;
    }
    
    @media (max-width: 520px) {
      body { padding: 15px; align-items: flex-start; padding-top: 80px; }
      .container { max-width: 100%; }
      .card { padding: 25px 20px; border-radius: 16px; }
      .logo-text { font-size: 2rem; }
      .logo-img { height: 55px; width: 55px; }
      .section-header h1 { font-size: 1.4rem; }
      .btn-group { flex-direction: column; }
      .form-progress { gap: 25px; }
      .progress-step { width: 36px; height: 36px; font-size: 0.9rem; }
      .step-label { font-size: 0.65rem; }
      .summary-grid { grid-template-columns: 1fr; }
      .lang-toggle { top: 15px; left: 15px; }
      .theme-toggle { top: 15px; right: 15px; }
      .theme-btn { width: 42px; height: 42px; }
      .notification-system { top: 70px; right: 15px; left: 15px; max-width: none; }
    }
  </style>
</head>
<body>
  <div class="lang-toggle">
    <button class="lang-btn" id="langToggle" onclick="toggleLanguage()">
      <i class="fas fa-globe"></i>
      <span id="langText">FR</span>
    </button>
  </div>

  <div class="theme-toggle">
    <button class="theme-btn" id="themeToggle" aria-label="Changer de theme">
      <i class="fas fa-moon"></i>
    </button>
  </div>
  
  <div class="notification-system" id="notificationSystem"></div>
  
  <div class="terms-modal" id="termsModal">
    <div class="terms-content">
      <h2 data-i18n="terms_title">Conditions d'utilisation</h2>
      <div id="termsContent"></div>
      <div class="btn-group" style="margin-top: 20px;">
        <button class="btn" onclick="closeTermsModal()" data-i18n="accept">J'accepte</button>
        <button class="btn btn-secondary" onclick="closeTermsModal()" data-i18n="close">Fermer</button>
      </div>
    </div>
  </div>
  
  <div class="confetti-container" id="confettiContainer"></div>

  <div class="container">
    <div class="logo-header">
      <div class="logo-container">
        <img src="https://raw.githubusercontent.com/exaucenapopolo/EARNESIA-GROUP/refs/heads/main/c8f725a49c3742ea90f599a9ca96329a.jpg" 
             alt="EARNESIA Logo" 
             class="logo-img"
             loading="lazy">
        <span class="logo-text">EARNESIA</span>
      </div>
      <div class="tagline" data-i18n="tagline">Ton futur en route</div>
    </div>

    <div class="form-progress">
      <div class="progress-step active" data-step="1">
        <span>1</span>
        <div class="step-label" data-i18n="step1">Identite</div>
      </div>
      <div class="progress-step" data-step="2">
        <span>2</span>
        <div class="step-label" data-i18n="step2">Contact</div>
      </div>
      <div class="progress-step" data-step="3">
        <span>3</span>
        <div class="step-label" data-i18n="step3">Securite</div>
      </div>
      <div class="progress-step" data-step="4">
        <span>4</span>
        <div class="step-label" data-i18n="step4">Confirmation</div>
      </div>
    </div>

    <div class="card">
      <div class="form-sections-container">
        <form id="registrationForm">
          <div class="form-section active" data-section="1">
            <div class="section-header">
              <h1 data-i18n="section1_title">Informations personnelles</h1>
              <p data-i18n="section1_desc">Commencez par vos informations de base</p>
            </div>
            
            <div class="form-group">
              <label for="username" data-i18n="username_label">Nom d'utilisateur *</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-user"></i></div>
                <input type="text" id="username" name="username" required 
                       data-i18n-placeholder="username_placeholder"
                       placeholder="Choisissez votre nom d'utilisateur"
                       autocomplete="username" minlength="3" maxlength="20">
              </div>
              <div class="input-hint" id="usernameHint"></div>
            </div>

            <div class="form-group">
              <label for="par" data-i18n="sponsor_label">Parrain (optionnel)</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-user-friends"></i></div>
                <input type="text" id="par" name="par" 
                       data-i18n-placeholder="sponsor_placeholder"
                       placeholder="Aucun parrain detecte" disabled>
              </div>
            </div>
          </div>

          <div class="form-section" data-section="2">
            <div class="section-header">
              <h1 data-i18n="section2_title">Coordonnees</h1>
              <p data-i18n="section2_desc">Comment pouvons-nous vous contacter ?</p>
            </div>
            
            <div class="form-group">
              <label for="email" data-i18n="email_label">Adresse e-mail *</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-envelope"></i></div>
                <input type="email" id="email" name="email" required 
                       placeholder="exemple@email.com" autocomplete="email">
              </div>
            </div>

            <div class="form-group">
              <label for="firstName" data-i18n="firstname_label">Prenom *</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-user-circle"></i></div>
                <input type="text" id="firstName" name="firstName" required 
                       data-i18n-placeholder="firstname_placeholder"
                       placeholder="Votre prenom" autocomplete="given-name">
              </div>
            </div>

            <div class="form-group">
              <label for="lastName" data-i18n="lastname_label">Nom de famille *</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-user-tag"></i></div>
                <input type="text" id="lastName" name="lastName" required 
                       data-i18n-placeholder="lastname_placeholder"
                       placeholder="Votre nom de famille" autocomplete="family-name">
              </div>
            </div>

            <div class="form-group">
              <label for="country" data-i18n="country_label">Pays *</label>
              <div style="position: relative;">
                <div class="input-group" id="countrySelector" style="cursor: pointer;">
                  <div class="input-icon"><i class="fas fa-globe-africa"></i></div>
                  <input type="text" id="countryDisplay" 
                         data-i18n-placeholder="country_placeholder"
                         placeholder="Selectionnez votre pays" readonly style="cursor: pointer;">
                  <input type="hidden" id="country" name="country">
                  <input type="hidden" id="countryCode" name="countryCode">
                  <i class="fas fa-chevron-down" style="margin-right: 15px; color: var(--dark-gray);"></i>
                </div>
                <div class="country-dropdown" id="countryDropdown"></div>
              </div>
            </div>

            <div class="form-group">
              <label for="phone" data-i18n="phone_label">Numero de telephone *</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-phone"></i></div>
                <input type="tel" id="phone" name="phone" required 
                       placeholder="6XX XXX XXX" autocomplete="tel">
              </div>
            </div>
          </div>

          <div class="form-section" data-section="3">
            <div class="section-header">
              <h1 data-i18n="section3_title">Securite du compte</h1>
              <p data-i18n="section3_desc">Protegez votre compte avec un mot de passe solide</p>
            </div>
            
            <div class="form-group">
              <label for="password" data-i18n="password_label">Mot de passe *</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-lock"></i></div>
                <input type="password" id="password" name="password" required 
                       data-i18n-placeholder="password_placeholder"
                       placeholder="Creez un mot de passe securise"
                       autocomplete="new-password" minlength="8">
                <button type="button" class="password-toggle" onclick="togglePassword('password')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="password-strength">
                <div class="strength-meter" id="strengthMeter"></div>
                <div class="strength-labels">
                  <span data-i18n="weak">Faible</span>
                  <span data-i18n="strong">Fort</span>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword" data-i18n="confirm_password_label">Confirmez le mot de passe *</label>
              <div class="input-group">
                <div class="input-icon"><i class="fas fa-lock"></i></div>
                <input type="password" id="confirmPassword" name="confirmPassword" required 
                       data-i18n-placeholder="confirm_password_placeholder"
                       placeholder="Confirmez votre mot de passe" autocomplete="new-password">
                <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <div class="form-group">
              <div class="checkbox-group">
                <input type="checkbox" id="human" name="human" required>
                <label for="human" class="terms-text" data-i18n="human_check">Je suis humain</label>
              </div>
            </div>
          </div>

          <div class="form-section" data-section="4">
            <div class="section-header">
              <h1 data-i18n="section4_title">Confirmation</h1>
              <p data-i18n="section4_desc">Verifiez vos informations avant de finaliser</p>
            </div>
            
            <div class="summary" id="registrationSummary"></div>

            <div class="form-group">
              <div class="checkbox-group">
                <input type="checkbox" id="terms" name="terms" required>
                <div class="terms-text">
                  <span data-i18n="terms_accept">J'accepte les</span> 
                  <a href="#" onclick="openTermsModal(); return false;" data-i18n="terms_link">Conditions d'utilisation</a> 
                  <span data-i18n="and">et la</span> 
                  <a href="#" onclick="openPrivacyModal(); return false;" data-i18n="privacy_link">Politique de confidentialite</a>.
                  <br><span data-i18n="activation_notice">Mon compte devra etre active apres mon paiement.</span>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
          <i class="fas fa-arrow-left"></i> <span data-i18n="previous">Precedent</span>
        </button>
        <button type="button" class="btn" id="nextBtn" onclick="nextStep()">
          <span data-i18n="next">Suivant</span> <i class="fas fa-arrow-right"></i>
        </button>
        <button type="submit" class="btn" id="submitBtn" style="display: none;" form="registrationForm">
          <i class="fas fa-user-plus"></i> <span data-i18n="create_account">Creer mon compte</span>
        </button>
      </div>

      <div class="login-link">
        <span data-i18n="have_account">Vous avez deja un compte?</span> 
        <a href="login.html" data-i18n="login_link">Connectez-vous</a>
      </div>
    </div>

    <div class="footer">
      <div>&copy; 2025 EARNESIA GROUP. <span data-i18n="rights">Tous droits reserves.</span></div>
      <div class="footer-links">
        <a href="#" onclick="openTermsModal(); return false;" data-i18n="terms_link">Conditions</a>
        <a href="#" onclick="openPrivacyModal(); return false;" data-i18n="privacy_link">Confidentialite</a>
        <a href="https://social-boost-horizon-new-sbh.vercel.app" target="_blank">Propulse par SBH</a>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCjGisjgbFc2ZE0BFgdhlUao8bCCeuKP1k",
      authDomain: "cash-flowr.firebaseapp.com",
      projectId: "cash-flowr",
      storageBucket: "cash-flowr.appspot.com",
      messagingSenderId: "1091928501310",
      appId: "1:1091928501310:web:4f4de306cde36f378ff56f"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Utiliser URL relative en dev, production URL sinon
    const SERVER_URL = window.location.hostname.includes('replit.dev') || window.location.hostname === 'localhost' 
      ? '' 
      : 'https://mulaflowr-exaucenapopolo2.replit.app';

    const translations = {
      fr: {
        tagline: "Ton futur en route",
        step1: "Identite", step2: "Contact", step3: "Securite", step4: "Confirmation",
        section1_title: "Informations personnelles", section1_desc: "Commencez par vos informations de base",
        section2_title: "Coordonnees", section2_desc: "Comment pouvons-nous vous contacter ?",
        section3_title: "Securite du compte", section3_desc: "Protegez votre compte avec un mot de passe solide",
        section4_title: "Confirmation", section4_desc: "Verifiez vos informations avant de finaliser",
        username_label: "Nom d'utilisateur *", username_placeholder: "Choisissez votre nom d'utilisateur",
        sponsor_label: "Parrain (optionnel)", sponsor_placeholder: "Aucun parrain detecte",
        email_label: "Adresse e-mail *", firstname_label: "Prenom *", firstname_placeholder: "Votre prenom",
        lastname_label: "Nom de famille *", lastname_placeholder: "Votre nom de famille",
        country_label: "Pays *", country_placeholder: "Selectionnez votre pays",
        phone_label: "Numero de telephone *",
        password_label: "Mot de passe *", password_placeholder: "Creez un mot de passe securise",
        confirm_password_label: "Confirmez le mot de passe *", confirm_password_placeholder: "Confirmez votre mot de passe",
        weak: "Faible", strong: "Fort", human_check: "Je suis humain",
        terms_accept: "J'accepte les", terms_link: "Conditions d'utilisation", and: "et la",
        privacy_link: "Politique de confidentialite", activation_notice: "Mon compte devra etre active apres mon paiement.",
        previous: "Precedent", next: "Suivant", create_account: "Creer mon compte",
        have_account: "Vous avez deja un compte?", login_link: "Connectez-vous",
        rights: "Tous droits reserves.", terms_title: "Conditions d'utilisation",
        accept: "J'accepte", close: "Fermer",
        success: "Succes", error: "Erreur", warning: "Attention", info: "Information",
        username_available: "Nom d'utilisateur disponible", username_taken: "Ce nom est deja pris",
        username_min: "Minimum 3 caracteres", field_required: "Ce champ est requis",
        invalid_email: "Format d'email invalide", password_weak: "Le mot de passe doit contenir au moins 8 caracteres",
        passwords_mismatch: "Les mots de passe ne correspondent pas",
        accept_terms: "Vous devez accepter les conditions", confirm_human: "Veuillez confirmer que vous etes humain",
        account_created: "Compte cree avec succes ! Redirection...", creating: "Creation en cours...",
        sponsor_detected: "Parrain detecte:",
        summary_username: "Nom d'utilisateur:", summary_email: "Email:", summary_firstname: "Prenom:",
        summary_lastname: "Nom:", summary_country: "Pays:", summary_phone: "Telephone:"
      },
      en: {
        tagline: "Your future on track",
        step1: "Identity", step2: "Contact", step3: "Security", step4: "Confirm",
        section1_title: "Personal Information", section1_desc: "Start with your basic information",
        section2_title: "Contact Details", section2_desc: "How can we reach you?",
        section3_title: "Account Security", section3_desc: "Protect your account with a strong password",
        section4_title: "Confirmation", section4_desc: "Review your information before finalizing",
        username_label: "Username *", username_placeholder: "Choose your username",
        sponsor_label: "Sponsor (optional)", sponsor_placeholder: "No sponsor detected",
        email_label: "Email address *", firstname_label: "First name *", firstname_placeholder: "Your first name",
        lastname_label: "Last name *", lastname_placeholder: "Your last name",
        country_label: "Country *", country_placeholder: "Select your country",
        phone_label: "Phone number *",
        password_label: "Password *", password_placeholder: "Create a secure password",
        confirm_password_label: "Confirm password *", confirm_password_placeholder: "Confirm your password",
        weak: "Weak", strong: "Strong", human_check: "I am human",
        terms_accept: "I accept the", terms_link: "Terms of Use", and: "and the",
        privacy_link: "Privacy Policy", activation_notice: "My account must be activated after payment.",
        previous: "Previous", next: "Next", create_account: "Create my account",
        have_account: "Already have an account?", login_link: "Log in",
        rights: "All rights reserved.", terms_title: "Terms of Use",
        accept: "I accept", close: "Close",
        success: "Success", error: "Error", warning: "Warning", info: "Information",
        username_available: "Username available", username_taken: "This username is taken",
        username_min: "Minimum 3 characters", field_required: "This field is required",
        invalid_email: "Invalid email format", password_weak: "Password must be at least 8 characters",
        passwords_mismatch: "Passwords do not match",
        accept_terms: "You must accept the terms", confirm_human: "Please confirm you are human",
        account_created: "Account created successfully! Redirecting...", creating: "Creating...",
        sponsor_detected: "Sponsor detected:",
        summary_username: "Username:", summary_email: "Email:", summary_firstname: "First name:",
        summary_lastname: "Last name:", summary_country: "Country:", summary_phone: "Phone:"
      }
    };

    let currentLang = localStorage.getItem('earnesia_lang') || 'fr';
    let currentStep = 1;
    let sponsorData = null;
    let isSubmitting = false;

    function t(key) {
      return translations[currentLang][key] || translations['fr'][key] || key;
    }

    function applyTranslations() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[currentLang][key]) {
          el.textContent = translations[currentLang][key];
        }
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (translations[currentLang][key]) {
          el.placeholder = translations[currentLang][key];
        }
      });
      document.getElementById('langText').textContent = currentLang.toUpperCase();
    }

    function toggleLanguage() {
      currentLang = currentLang === 'fr' ? 'en' : 'fr';
      localStorage.setItem('earnesia_lang', currentLang);
      applyTranslations();
      if (currentStep === 4) updateSummary();
    }

    const savedTheme = localStorage.getItem('earnesia_theme');
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
      document.body.classList.add('dark-mode');
      document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
    }

    document.getElementById('themeToggle').addEventListener('click', function() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      this.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      localStorage.setItem('earnesia_theme', isDark ? 'dark' : 'light');
    });

    const countries = [
      { code: 'cm', name: 'Cameroun', flag: '\uD83C\uDDE8\uD83C\uDDF2', phoneCode: '+237' },
      { code: 'ci', name: "Cote d'Ivoire", flag: '\uD83C\uDDE8\uD83C\uDDEE', phoneCode: '+225' },
      { code: 'sn', name: 'Senegal', flag: '\uD83C\uDDF8\uD83C\uDDF3', phoneCode: '+221' },
      { code: 'ng', name: 'Nigeria', flag: '\uD83C\uDDF3\uD83C\uDDEC', phoneCode: '+234' },
      { code: 'gh', name: 'Ghana', flag: '\uD83C\uDDEC\uD83C\uDDED', phoneCode: '+233' },
      { code: 'ke', name: 'Kenya', flag: '\uD83C\uDDF0\uD83C\uDDEA', phoneCode: '+254' },
      { code: 'za', name: 'Afrique du Sud', flag: '\uD83C\uDDFF\uD83C\uDDE6', phoneCode: '+27' },
      { code: 'cd', name: 'RD Congo', flag: '\uD83C\uDDE8\uD83C\uDDE9', phoneCode: '+243' },
      { code: 'ga', name: 'Gabon', flag: '\uD83C\uDDEC\uD83C\uDDE6', phoneCode: '+241' },
      { code: 'bj', name: 'Benin', flag: '\uD83C\uDDE7\uD83C\uDDEF', phoneCode: '+229' },
      { code: 'tg', name: 'Togo', flag: '\uD83C\uDDF9\uD83C\uDDEC', phoneCode: '+228' },
      { code: 'ml', name: 'Mali', flag: '\uD83C\uDDF2\uD83C\uDDF1', phoneCode: '+223' },
      { code: 'bf', name: 'Burkina Faso', flag: '\uD83C\uDDE7\uD83C\uDDEB', phoneCode: '+226' },
      { code: 'ne', name: 'Niger', flag: '\uD83C\uDDF3\uD83C\uDDEA', phoneCode: '+227' },
      { code: 'gn', name: 'Guinee', flag: '\uD83C\uDDEC\uD83C\uDDF3', phoneCode: '+224' },
      { code: 'fr', name: 'France', flag: '\uD83C\uDDEB\uD83C\uDDF7', phoneCode: '+33' },
      { code: 'be', name: 'Belgique', flag: '\uD83C\uDDE7\uD83C\uDDEA', phoneCode: '+32' },
      { code: 'ch', name: 'Suisse', flag: '\uD83C\uDDE8\uD83C\uDDED', phoneCode: '+41' }
    ];

    function initCountrySelector() {
      const dropdown = document.getElementById('countryDropdown');
      dropdown.innerHTML = countries.map(c => 
        '<div class="country-option" onclick="selectCountry(\'' + c.code + '\')">' +
        '<span class="flag">' + c.flag + '</span>' +
        '<span>' + c.name + '</span>' +
        '<span style="color: var(--dark-gray); margin-left: auto;">' + c.phoneCode + '</span>' +
        '</div>'
      ).join('');
      selectCountry('cm');
    }

    function selectCountry(code) {
      const country = countries.find(function(c) { return c.code === code; });
      if (!country) return;
      document.getElementById('countryDisplay').value = country.flag + ' ' + country.name;
      document.getElementById('country').value = country.code;
      document.getElementById('countryCode').value = country.phoneCode;
      document.getElementById('countryDropdown').classList.remove('show');
    }

    document.getElementById('countrySelector').addEventListener('click', function(e) {
      e.stopPropagation();
      document.getElementById('countryDropdown').classList.toggle('show');
    });

    document.addEventListener('click', function() {
      document.getElementById('countryDropdown').classList.remove('show');
    });

    function showNotification(type, title, message) {
      var container = document.getElementById('notificationSystem');
      var icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', warning: 'fa-exclamation-triangle', info: 'fa-info-circle' };
      var el = document.createElement('div');
      el.className = 'notification ' + type;
      el.innerHTML = '<div class="notification-info"><div class="notification-title"><i class="fas ' + icons[type] + '"></i> ' + title + '</div><div class="notification-message">' + message + '</div></div><button class="notification-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>';
      container.appendChild(el);
      setTimeout(function() { if (el.parentElement) el.remove(); }, 5000);
    }

    function validateStep(step) {
      var section = document.querySelector('[data-section="' + step + '"]');
      var inputs = section.querySelectorAll('input[required]');
      var valid = true;

      inputs.forEach(function(input) {
        var group = input.closest('.input-group');
        if (!input.value.trim()) {
          group.classList.add('error');
          valid = false;
          setTimeout(function() { group.classList.remove('error'); }, 3000);
        } else if (input.type === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
          group.classList.add('error');
          showNotification('error', t('error'), t('invalid_email'));
          valid = false;
          setTimeout(function() { group.classList.remove('error'); }, 3000);
        }
      });

      if (step === 3) {
        var pwd = document.getElementById('password').value;
        var confirm = document.getElementById('confirmPassword').value;
        if (pwd.length < 8) {
          showNotification('error', t('error'), t('password_weak'));
          valid = false;
        } else if (pwd !== confirm) {
          showNotification('error', t('error'), t('passwords_mismatch'));
          document.getElementById('confirmPassword').closest('.input-group').classList.add('error');
          valid = false;
        }
      }

      if (!valid) showNotification('error', t('error'), t('field_required'));
      return valid;
    }

    function goToStep(step) {
      var sections = document.querySelectorAll('.form-section');
      var progress = document.querySelectorAll('.progress-step');
      
      sections.forEach(function(s, i) {
        s.classList.remove('active');
        if (i + 1 === step) {
          s.classList.add('active');
        }
      });

      progress.forEach(function(p, i) {
        p.classList.remove('active', 'completed');
        if (i + 1 === step) p.classList.add('active');
        else if (i + 1 < step) p.classList.add('completed');
      });

      currentStep = step;
      document.getElementById('prevBtn').style.display = step === 1 ? 'none' : 'inline-flex';
      document.getElementById('nextBtn').style.display = step === 4 ? 'none' : 'inline-flex';
      document.getElementById('submitBtn').style.display = step === 4 ? 'inline-flex' : 'none';

      if (step === 4) updateSummary();
    }

    function nextStep() {
      if (!validateStep(currentStep)) return;
      if (currentStep < 4) goToStep(currentStep + 1);
    }

    function previousStep() {
      if (currentStep > 1) goToStep(currentStep - 1);
    }

    function updateSummary() {
      var summary = document.getElementById('registrationSummary');
      summary.innerHTML = '<div class="summary-grid">' +
        '<div class="summary-item"><span class="summary-label">' + t('summary_username') + '</span><span class="summary-value">' + document.getElementById('username').value + '</span></div>' +
        '<div class="summary-item"><span class="summary-label">' + t('summary_email') + '</span><span class="summary-value">' + document.getElementById('email').value + '</span></div>' +
        '<div class="summary-item"><span class="summary-label">' + t('summary_firstname') + '</span><span class="summary-value">' + document.getElementById('firstName').value + '</span></div>' +
        '<div class="summary-item"><span class="summary-label">' + t('summary_lastname') + '</span><span class="summary-value">' + document.getElementById('lastName').value + '</span></div>' +
        '<div class="summary-item"><span class="summary-label">' + t('summary_country') + '</span><span class="summary-value">' + document.getElementById('countryDisplay').value + '</span></div>' +
        '<div class="summary-item"><span class="summary-label">' + t('summary_phone') + '</span><span class="summary-value">' + document.getElementById('phone').value + '</span></div>' +
        '</div>';
    }

    function togglePassword(id) {
      var input = document.getElementById(id);
      var icon = input.nextElementSibling.querySelector('i');
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }

    document.getElementById('password').addEventListener('input', function() {
      var pwd = this.value;
      var score = 0;
      if (pwd.length >= 8) score++;
      if (/[A-Z]/.test(pwd)) score++;
      if (/[a-z]/.test(pwd)) score++;
      if (/[0-9]/.test(pwd)) score++;
      if (/[^A-Za-z0-9]/.test(pwd)) score++;
      
      var strength = (score / 5) * 100;
      var meter = document.getElementById('strengthMeter');
      var color = '#ff6b6b';
      if (strength >= 60) color = '#ffd166';
      if (strength >= 80) color = '#00cc88';
      meter.style.setProperty('--strength', strength + '%');
      meter.style.setProperty('--strength-color', color);
    });

    var usernameTimeout;
    document.getElementById('username').addEventListener('input', function() {
      var username = this.value.trim().toLowerCase();
      var hint = document.getElementById('usernameHint');
      clearTimeout(usernameTimeout);
      
      if (username.length < 3) {
        hint.textContent = t('username_min');
        hint.style.color = '#ff6b6b';
        return;
      }

      hint.textContent = '...';
      hint.style.color = 'var(--dark-gray)';

      usernameTimeout = setTimeout(function() {
        fetch(SERVER_URL + '/api/check-username/' + encodeURIComponent(username))
          .then(function(response) { return response.json(); })
          .then(function(data) {
            if (data.available) {
              hint.innerHTML = '<i class="fas fa-check"></i> ' + t('username_available');
              hint.style.color = '#00cc88';
            } else {
              hint.innerHTML = '<i class="fas fa-times"></i> ' + t('username_taken');
              hint.style.color = '#ff6b6b';
            }
          })
          .catch(function(e) {
            hint.textContent = '';
          });
      }, 500);
    });

    function triggerConfetti() {
      var container = document.getElementById('confettiContainer');
      var colors = ['#3a86ff', '#00b4d8', '#00cc88', '#ff6b6b', '#ffd166', '#9d4edd'];
      
      for (var i = 0; i < 60; i++) {
        var confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-20px';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.setProperty('--tx', (Math.random() - 0.5) * 300 + 'px');
        confetti.style.setProperty('--ty', (Math.random() * 600 + 400) + 'px');
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(confetti);
      }
      setTimeout(function() { container.innerHTML = ''; }, 3000);
    }

    function openTermsModal() {
      document.getElementById('termsContent').innerHTML = '<h3>Conditions Generales d\'Utilisation</h3><p>Derniere mise a jour: ' + new Date().toLocaleDateString(currentLang === 'fr' ? 'fr-FR' : 'en-US') + '</p><h4>1. Acceptation</h4><p>En creant un compte sur EARNESIA, vous acceptez ces conditions.</p><h4>2. Services</h4><p>EARNESIA est une plateforme d\'opportunites financieres avec programmes de parrainage.</p><h4>3. Responsabilites</h4><p>Vous etes responsable de la confidentialite de votre compte.</p><h4>4. Paiements</h4><p>Les paiements sont traites de maniere securisee selon les termes du programme.</p>';
      document.getElementById('termsModal').classList.add('show');
    }

    function openPrivacyModal() {
      document.getElementById('termsContent').innerHTML = '<h3>Politique de Confidentialite</h3><p>Derniere mise a jour: ' + new Date().toLocaleDateString(currentLang === 'fr' ? 'fr-FR' : 'en-US') + '</p><h4>1. Collecte</h4><p>Nous collectons les informations fournies lors de l\'inscription.</p><h4>2. Utilisation</h4><p>Vos informations servent a gerer votre compte et traiter les transactions.</p><h4>3. Protection</h4><p>Nous utilisons des mesures de securite avancees.</p><h4>4. Vos droits</h4><p>Vous pouvez acceder, modifier ou supprimer vos informations.</p>';
      document.getElementById('termsModal').classList.add('show');
    }

    function closeTermsModal() {
      document.getElementById('termsModal').classList.remove('show');
    }

    document.getElementById('registrationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      if (isSubmitting) return;

      if (!document.getElementById('terms').checked) {
        showNotification('error', t('error'), t('accept_terms'));
        return;
      }
      if (!document.getElementById('human').checked) {
        showNotification('error', t('error'), t('confirm_human'));
        return;
      }

      isSubmitting = true;
      var submitBtn = document.getElementById('submitBtn');
      var originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="loading"></span> ' + t('creating');
      submitBtn.disabled = true;

      var username = document.getElementById('username').value.trim();
      var email = document.getElementById('email').value.trim();
      var password = document.getElementById('password').value;
      var firstName = document.getElementById('firstName').value.trim();
      var lastName = document.getElementById('lastName').value.trim();
      var country = document.getElementById('country').value;
      var countryCode = document.getElementById('countryCode').value;
      var phone = document.getElementById('phone').value.trim();

      fetch(SERVER_URL + '/api/register-complete', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: username,
          email: email,
          password: password,
          firstName: firstName,
          lastName: lastName,
          country: country,
          phone: phone,
          countryCode: countryCode,
          sponsorUsername: sponsorData ? sponsorData.username : ''
        })
      })
      .then(function(response) {
        return response.json().then(function(data) {
          if (!response.ok || !data.ok) {
            throw { code: data.code || 'SERVER_ERROR', message: data.error || 'Erreur serveur' };
          }
          return data;
        });
      })
      .then(function(data) {
        console.log('Inscription reussie:', data);
        submitBtn.innerHTML = '<i class="fas fa-check"></i> ' + t('account_created');
        showNotification('success', t('success'), t('account_created'));
        triggerConfetti();
        
        localStorage.setItem('earnesia_username', data.username);
        localStorage.setItem('earnesia_uid', data.uid);
        
        setTimeout(function() {
          window.location.href = 'paiement.html';
        }, 2500);
      })
      .catch(function(error) {
        console.error('Registration error:', error);
        var errorMsg = error.message || 'Erreur lors de l\'inscription';
        
        if (error.code === 'EMAIL_EXISTS') errorMsg = 'Cette adresse email est deja utilisee';
        else if (error.code === 'USERNAME_TAKEN') errorMsg = 'Ce nom d\'utilisateur est deja pris';
        else if (error.code === 'WEAK_PASSWORD') errorMsg = 'Mot de passe trop faible (min 8 caracteres)';
        else if (error.code === 'INVALID_EMAIL') errorMsg = 'Adresse email invalide';
        else if (error.code === 'MISSING_FIELDS') errorMsg = 'Tous les champs obligatoires doivent etre remplis';
        
        showNotification('error', t('error'), errorMsg);
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        isSubmitting = false;
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
      applyTranslations();
      initCountrySelector();

      var urlParams = new URLSearchParams(window.location.search);
      var refParam = urlParams.get('ref') || urlParams.get('par') || '';
      
      if (refParam) {
        db.collection('users').where('username', '==', refParam.trim()).get()
          .then(function(snapshot) {
            if (!snapshot.empty) {
              var doc = snapshot.docs[0];
              sponsorData = { username: doc.data().username, displayName: doc.data().displayName || doc.data().username };
              document.getElementById('par').value = sponsorData.displayName;
              showNotification('info', t('info'), t('sponsor_detected') + ' ' + sponsorData.displayName);
            }
          })
          .catch(function(e) { console.warn('Sponsor check failed:', e); });
      }
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && e.target.type !== 'checkbox') {
        e.preventDefault();
        if (currentStep < 4) nextStep();
        else document.getElementById('registrationForm').requestSubmit();
      }
      if (e.key === 'Escape') closeTermsModal();
    });
  </script>
</body>
</html>
